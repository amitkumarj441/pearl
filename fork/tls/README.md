Mostly copied from `crypto/tls` in Go 1.8.1. Some internal dependencies also
copied over, with imports changed as necessary.
